# GCP Deployment Guide

## Prerequisites
- Google Cloud Account with billing enabled
- Google Cloud CLI (`gcloud`) installed and configured
- Docker installed locally
- Project ID from GCP

## Option 1: Deploy to Cloud Run (Recommended - Serverless)

### Step 1: Set up Google Cloud
```bash
# Set your GCP project
gcloud config set project YOUR_PROJECT_ID

# Enable required APIs
gcloud services enable run.googleapis.com
gcloud services enable containerregistry.googleapis.com
gcloud services enable cloudbuild.googleapis.com
```

### Step 2: Build and Push to Container Registry
```bash
# Build image
docker build -t gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest .

# Push to Google Container Registry
docker push gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest
```

### Step 3: Deploy to Cloud Run
```bash
gcloud run deploy amazon-price-tracker \
  --image gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest \
  --platform managed \
  --region us-central1 \
  --port 5000 \
  --memory 512Mi \
  --cpu 1 \
  --timeout 3600 \
  --allow-unauthenticated
```

### Step 4: Set Environment Variables
```bash
gcloud run services update amazon-price-tracker \
  --region us-central1 \
  --set-env-vars "FLASK_ENV=production"
```

---

## Option 2: Deploy to GKE (Kubernetes)

### Step 1: Create a GKE Cluster
```bash
# Create cluster
gcloud container clusters create amazon-tracker-cluster \
  --zone us-central1-a \
  --num-nodes 1 \
  --machine-type e2-small

# Get credentials
gcloud container clusters get-credentials amazon-tracker-cluster --zone us-central1-a
```

### Step 2: Build and Push Image
```bash
docker build -t gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest .
docker push gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest
```

### Step 3: Deploy using kubectl
```bash
# Create deployment and service
kubectl apply -f k8s-deployment.yaml

# Check deployment status
kubectl get deployments
kubectl get services
```

---

## Option 3: Deploy to Compute Engine (VMs)

### Step 1: Create VM Instance
```bash
gcloud compute instances create amazon-tracker-vm \
  --image-family=debian-11 \
  --image-project=debian-cloud \
  --machine-type=e2-small \
  --zone=us-central1-a
```

### Step 2: SSH into VM and Set Up
```bash
gcloud compute ssh amazon-tracker-vm --zone=us-central1-a

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Clone your repository and run
git clone <your-repo>
cd Amazon_Price_Tracker
docker-compose up -d
```

---

## Configuration Files Needed

Create a `config.json` file in your project root:
```json
{
  "products": [
    {
      "url": "https://www.amazon.in/...",
      "target_price": 1000,
      "name": "Product Name"
    }
  ],
  "notifications": {
    "email": "your-email@gmail.com",
    "phone_number": "+91XXXXXXXXXX"
  }
}
```

Also create a `.env` file:
```
FLASK_ENV=production
CORS_ORIGIN=*
```

---

## Monitoring and Logs

### Cloud Run Logs
```bash
gcloud run services describe amazon-price-tracker --region us-central1
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=amazon-price-tracker" --limit 50
```

### GKE Logs
```bash
kubectl logs deployment/amazon-price-tracker
kubectl logs -l app=amazon-price-tracker --tail=50
```

---

## Cost Optimization Tips

1. **Cloud Run**: Free tier includes 2M requests/month - ideal for light usage
2. **GKE**: Use Autopilot for managed Kubernetes
3. **Compute Engine**: Use preemptible VMs for cost savings
4. **Scheduled Tasks**: Use Cloud Scheduler for tracker updates instead of always-on services

---

## Troubleshooting

### Port Already in Use
```bash
# For local testing
docker run -p 8000:5000 gcr.io/YOUR_PROJECT_ID/amazon-price-tracker:latest
```

### Permission Issues
```bash
# Grant permissions to service account
gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member=serviceAccount:YOUR_SERVICE_ACCOUNT \
  --role=roles/run.invoker
```

### Database Connection Issues
Ensure PostgreSQL is configured and accessible, or use SQLite with persistent volumes.
